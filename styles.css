/* Variables et thème */
:root {
  color-scheme: light dark;
  --bg: #ffffff;
  --bg2: #f3f4f6;
  --fg: #111827;
  --muted: #374151; /* un peu plus foncé pour meilleur contraste sur fond clair */
  --header-bg: #f7f7f7;
  --header-border: #e5e7eb;
}
@media (prefers-color-scheme: dark) {
  :root {
    color-scheme: dark;
    --bg: #0b0f1a;
    --bg2: #121826;
    --fg: #e5e7eb;
    --muted: #cbd5e1; /* plus clair pour lisibilité sur fond sombre */
    --header-bg: #0f1627;
    --header-border: #1f2937;
  }
}
/* Manual theme override */
:root[data-theme="light"] {
  color-scheme: light;
  --bg: #ffffff; --bg2: #f3f4f6; --fg: #111827; --muted: #374151; --header-bg: #f7f7f7; --header-border: #e5e7eb;
}
:root[data-theme="dark"] {
  color-scheme: dark;
  --bg: #0b0f1a; --bg2: #121826; --fg: #e5e7eb; --muted: #cbd5e1; --header-bg: #0f1627; --header-border: #1f2937;
}

html, body {
  height: 100%;
}
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  background: var(--bg);
  color: var(--fg);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 16px;
  background: var(--header-bg);
  border-bottom: 1px solid var(--header-border);
}
header h1 {
  font-size: 16px;
  margin: 0;
}
header .brand-logo {
  height: 40px;
  display: block;
  margin-left: 12px;
}
.marker-hint { position:absolute; transform: translate(-50%, -100%); background: var(--bg); color: var(--fg); border:1px solid var(--header-border); border-radius:6px; padding:2px 6px; font-size:12px; pointer-events:none; box-shadow:0 4px 12px rgba(0,0,0,0.15); display:none; z-index:1001; }
.controls {
  display: inline-flex;
  gap: 12px;
  align-items: center;
  color: var(--muted);
}
.hdr-toggle { display:inline-flex; align-items:center; gap:6px; }
.link-btn { background: transparent; border: none; color: var(--fg); cursor: pointer; padding: 0 4px; font: inherit; }
.link-btn:hover { text-decoration: underline; }
select#interval {
  padding: 4px 6px;
}
/* Harmonise la couleur des contrôles natifs en clair/sombre */
select, input, textarea, button { color: var(--fg); background: var(--bg); }
option { color: var(--fg); background: var(--bg); }
::placeholder { color: var(--muted); opacity: 0.9; }

main {
  flex: 1;
  min-height: 0; /* nécessaire pour que #chart prenne toute la hauteur */
  display: flex; /* pour que #chart puisse remplir l'espace */
}
#chart {
  width: 100%;
  flex: 1;
  min-height: 360px; /* plus de hauteur par défaut */
  border-top: 1px solid var(--header-border);
  background: var(--bg);
  position: relative; /* pour overlay LBC */
  padding-top: 8px; /* espace visuel */
}
#gotoEndBtn { position:absolute; right:12px; bottom:12px; z-index:1002; pointer-events:auto; background:#ffffff; color:#000000; border:1px solid var(--header-border); }

/* statut texte discret dans le header */
.status {
  color: var(--muted);
  font-size: 12px;
}

/* Boutons */
.btn {
  background: transparent;
  border: 1px solid var(--header-border);
  color: var(--fg);
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
}
.btn:hover { background: var(--bg2); }
.btn.primary { background: #2563eb; border-color: #2563eb; color: #fff; }
.btn.primary:hover { filter: brightness(0.95); }
.icon-btn { background: transparent; border: none; font-size: 20px; cursor: pointer; color: var(--fg); }

/* Modal */
.modal.hidden { display: none; }
.modal { position: fixed; inset: 0; z-index: 5000; }
/* Assure la priorité de la barre de progression au-dessus des autres modales */
#btProgress.modal { z-index: 6000; }
#stratModal.modal { z-index: 7000; }
#weightsModal.modal { z-index: 8000; }
.modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.45); }
.modal-content {
  position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
  width: min(860px, calc(100% - 32px)); max-height: calc(100% - 32px);
  background: var(--bg); color: var(--fg);
  border: 1px solid var(--header-border);
  border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.25);
  display: flex; flex-direction: column;
}
.modal-content.small { width: min(420px, calc(100% - 32px)); }
.progress { width: 100%; height: 10px; background: var(--header-border); border-radius: 6px; overflow: hidden; }
.progress > #btProgBar { height: 100%; width: 0%; background: #2563eb; transition: width 120ms linear; }
.modal-header { display:flex; align-items:center; justify-content:space-between; padding: 12px 14px; border-bottom: 1px solid var(--header-border); }
.modal-body { padding: 12px 14px; overflow: auto; }
.modal-footer { display:flex; justify-content: flex-end; gap:8px; padding: 12px 14px; border-top: 1px solid var(--header-border); }
.form-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
fieldset { border:1px solid var(--header-border); border-radius: 10px; padding: 10px; }
legend { padding: 0 6px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.04em; font-size: 12px; }
label { display:flex; align-items:center; gap:8px; margin:6px 0; }

/* Floating compact windows (discreet look) */
.modal-content.floating-compact {
  background: rgba(255,255,255,0.92);
  box-shadow: 0 10px 28px rgba(0,0,0,0.18);
  border-radius: 10px;
  backdrop-filter: saturate(1.1) blur(6px);
}
@media (prefers-color-scheme: dark) {
  .modal-content.floating-compact { background: rgba(14,18,30,0.88); }
}
/* removed global opacity; header legibility improved */
.modal-content.floating-compact .modal-header,
.modal-content.floating-compact .modal-footer { padding: 8px 10px; }
.modal-content.floating-compact .modal-body { padding: 8px 10px; }
.modal-content.floating-compact .modal-header h2 { font-size: 13px; margin: 0; color: var(--muted); }
.modal-content.floating-compact .btn { padding: 4px 8px; border-radius: 6px; font-size: 12px; }
.modal-content.floating-compact .icon-btn { font-size: 16px; color: var(--muted); }
.modal-content.floating-compact .lbc-table th,
.modal-content.floating-compact .lbc-table td { padding: 3px 5px; font-size: 12px; }
.modal-content.floating-compact .lbc-table thead th { background: transparent; }
.modal-content.floating-compact[data-collapsed="1"] .modal-body,
.modal-content.floating-compact[data-collapsed="1"] .modal-footer { display: none !important; }
.modal-content.floating-compact[data-collapsed="1"] { opacity: 0.85; overflow: hidden; }

/* Overlay cards */
.lbc-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 3000; }
.lbc-card {
  position: absolute;
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--header-border);
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  padding: 8px 10px; min-width: 160px;
  pointer-events: auto;
  font-size: 12px;
}
/* Place Heaven (lbc-prob) bottom-left */
#lbc-prob { left: 12px; bottom: 12px; top: auto; right: auto; }
.lbc-card.resizable { resize: both; overflow: auto; }
.lbc-card .card-header { display:flex; align-items:center; justify-content:space-between; gap:8px; cursor: move; user-select: none; }
.lbc-card .card-body { margin-top:6px; }
.lbc-card .card-body.grid2 { display:grid; grid-template-columns:repeat(2,minmax(120px,1fr)); gap:6px; }
.lbc-card.collapsed .card-body { display:none !important; }
.lbc-card.hidden { display: none; }
.lbc-card.small { font-size: 11px; }
.lbc-card.normal { font-size: 13px; }
.lbc-card.large { font-size: 15px; }

/* Lab panels inside Lab modal */
.lab-panels { display:grid; grid-template-columns: 1fr 320px; gap: 10px; align-items:start; }
.kpi-cards { display:grid; grid-template-columns: repeat(4, minmax(80px, 1fr)); gap:8px; }
.kpi-item { border:1px solid var(--header-border); border-radius:8px; padding:8px; background: var(--bg); }
.kpi-label { color: var(--muted); font-size: 11px; }
.kpi-value { font-weight: 600; font-size: 16px; }

.lbc-table { border-collapse: collapse; width: 100%; }
.lbc-table th, .lbc-table td { border: 1px solid var(--header-border); padding: 4px 6px; text-align: center; }
.lbc-table thead th { position: sticky; top: 0; background: var(--bg); z-index: 3; box-shadow: 0 1px 0 var(--header-border); }
.lbc-table tbody tr:hover { background: var(--header-bg); }
.lbc-table .up { background: #9feec8; }
.lbc-table .dn { background: #f69a9a; }
/* Trade table expand/collapse */
.lbc-table tr.trade-parent { cursor: pointer; }
.lbc-table tr.subrow { background: rgba(0,0,0,0.03); }
@media (prefers-color-scheme: dark) {
  .lbc-table tr.subrow { background: rgba(255,255,255,0.04); }
}
/* Ensure sticky header in Trades modal stays fully opaque */
#tradesModal .lbc-table thead th {
  position: sticky; top: 0;
  background: var(--bg) !important;
  z-index: 10;
  box-shadow: 0 1px 0 var(--header-border);
}
/* Direction colors */
.dir-long { color: #10b981; }
.dir-short { color: #ef4444; }
/* P&L percent colors */
.pnl-pos { color: #10b981; }
.pnl-neg { color: #ef4444; }
.pnl-zero { color: var(--muted); }
.caret { display:inline-block; transition: transform 120ms ease; margin-right:4px; }

/* Preloader video overlay */
#preloadOverlay { position: fixed; inset: 0; z-index: 10000; background: #000; display:flex; align-items:center; justify-content:center; }
#preloadOverlay.hidden { display: none; }
#preloadClip { position:absolute; left:50%; top:50%; transform: translate(-50%, -50%); width:100vw; height:100vh; border-radius: 0px; box-shadow: 0 0 0 rgba(0,0,0,0); overflow: hidden; }
#preloadSheet { position:absolute; inset:0; transform-origin: 50% 50%; transform-style: preserve-3d; backface-visibility: hidden; }
#preloadSheet.sheet-hide { opacity: 0; transition: opacity 160ms ease; }
#preloadSheet::before { content:''; position:absolute; inset:0; pointer-events:none; opacity:0; background:
  /* Primary grid (horizontal/vertical) */
  repeating-linear-gradient(0deg, rgba(255,255,255,0.10) 0, rgba(255,255,255,0.10) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 40px),
  repeating-linear-gradient(90deg, rgba(0,0,0,0.12) 0, rgba(0,0,0,0.12) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 40px),
  /* Diagonal creases */
  repeating-linear-gradient(45deg, rgba(255,255,255,0.06) 0, rgba(255,255,255,0.06) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 56px),
  repeating-linear-gradient(135deg, rgba(0,0,0,0.08) 0, rgba(0,0,0,0.08) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 56px);
  mix-blend-mode: overlay;
}
#preloadSheet.deform-weak { filter: url(#paperDisplaceWeak) contrast(1.02) saturate(1.03); }
#preloadSheet.deform-strong { filter: url(#paperDisplaceStrong) contrast(1.03) saturate(1.04); }
#preloadSheet.deform-pro { filter: url(#paperDisplacePro) contrast(1.05) saturate(1.05); }
#preloadSheet::after { content:''; position:absolute; inset:0; pointer-events:none; background:
  radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.08), rgba(255,255,255,0) 60%),
  radial-gradient(ellipse at 70% 70%, rgba(0,0,0,0.06), rgba(0,0,0,0) 60%),
  repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.05) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 3px);
  mix-blend-mode: overlay; opacity: 0.35;
}
/* show 3D crease grid */
#preloadSheet.grid-on::before { opacity: 0.55; transition: opacity 180ms ease; }
#preloadSheet.grid-anim::before { animation: gridShimmer 900ms ease-in-out both; }
#preloadVideo, #preloadCanvas { display:block; width:100vw; height:100vh; object-fit: cover; }
#preloadGL { position:absolute; inset:0; display:none; pointer-events:none; z-index:2; }
#preloadRoulette { position:absolute; inset:0; display:none; pointer-events:none; z-index:3; }
#preloadRoulette.show { display:block; opacity: 1; }
#preloadRoulette.fade { transition: opacity 250ms ease; opacity: 0; }
#preloadPlane { position:absolute; inset:0; opacity:0; pointer-events:none; background-size: cover; background-position: center; transform-origin: 50% 50%; transform-style: preserve-3d; filter: drop-shadow(0 14px 28px rgba(0,0,0,0.28)); z-index:1; }
#preloadPlane.plane-on { opacity: 1; transition: opacity 160ms ease; }
#preloadPlane.plane-fold { animation: planeFold 800ms cubic-bezier(0.22,1,0.36,1) forwards; }
#preloadPlane.plane-flight { animation: planeFlight 1100ms cubic-bezier(0.22,1,0.36,1) forwards; }

/* Lab Advanced: CSS-only toggle via hidden checkbox */
#labModal input#labAdvEn:checked ~ .modal-header #labAdvLabel {
  background: #2563eb;
  border-color: #2563eb;
  color: #fff;
}
#labModal input#labAdvEn:checked ~ .modal-body #labAdvPanel,
#labModal input#labAdvEn:checked ~ .modal-body #labCoreRanges,
#labModal input#labAdvEn:checked ~ .modal-body #labTPOptBlock,
#labModal input#labAdvEn:checked ~ .modal-body #labTPFibWrap,
#labModal input#labAdvEn:checked ~ .modal-body #labSLOptBlock,
#labModal input#labAdvEn:checked ~ .modal-body #labSLFibWrap,
#labModal input#labAdvEn:checked ~ .modal-body #labEAConfig,
#labModal input#labAdvEn:checked ~ .modal-body #labBayesConfig {
  display: flex !important;
}
/* Core ranges: one parameter per row, 3 columns (Min / Max / Pas) */
#labCoreRanges .core-range-row {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  align-items: center;
}
#labCoreRanges .core-range-row .col { display: inline-flex; align-items: center; gap: 6px; }
#labCoreRanges .core-range-head {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  font-size: 12px;
  color: var(--muted);
  margin: 2px 0 6px;
}
#labCoreRanges .core-range-head span { text-transform: uppercase; letter-spacing: 0.02em; }
/* Inline help toggles for parameter titles */
#labCoreRanges details.param-help-inline,
#labTPOptBlock details.param-help-inline,
#labSLOptBlock details.param-help-inline,
#labTPFibWrap details.param-help-inline,
#labSLFibWrap details.param-help-inline,
#labEAConfig details.param-help-inline,
#labBayesConfig details.param-help-inline,
#labModal details.param-help-inline {
  display: inline-block;
  position: relative;
}
#labCoreRanges details.param-help-inline summary,
#labTPOptBlock details.param-help-inline summary,
#labSLOptBlock details.param-help-inline summary,
#labTPFibWrap details.param-help-inline summary,
#labSLFibWrap details.param-help-inline summary,
#labEAConfig details.param-help-inline summary,
#labBayesConfig details.param-help-inline summary,
#labModal details.param-help-inline summary {
  cursor: pointer;
  color: #2563eb;
  text-decoration: underline;
  margin-right: 6px;
}
/* Hide default marker in most browsers */
#labCoreRanges details.param-help-inline summary::-webkit-details-marker,
#labTPOptBlock details.param-help-inline summary::-webkit-details-marker,
#labSLOptBlock details.param-help-inline summary::-webkit-details-marker,
#labTPFibWrap details.param-help-inline summary::-webkit-details-marker,
#labSLFibWrap details.param-help-inline summary::-webkit-details-marker,
#labEAConfig details.param-help-inline summary::-webkit-details-marker,
#labBayesConfig details.param-help-inline summary::-webkit-details-marker,
#labModal details.param-help-inline summary::-webkit-details-marker { display: none; }
#labCoreRanges details.param-help-inline .param-help,
#labTPOptBlock details.param-help-inline .param-help,
#labSLOptBlock details.param-help-inline .param-help,
#labTPFibWrap details.param-help-inline .param-help,
#labSLFibWrap details.param-help-inline .param-help,
#labEAConfig details.param-help-inline .param-help,
#labBayesConfig details.param-help-inline .param-help,
#labModal details.param-help-inline .param-help {
  display: none;
  margin-top: 6px;
  padding: 6px;
  border: 1px solid var(--header-border);
  border-radius: 6px;
  background: var(--bg2, rgba(0,0,0,0.04));
  color: var(--muted);
  font-size: 12px;
}
#labCoreRanges details.param-help-inline[open] .param-help,
#labTPOptBlock details.param-help-inline[open] .param-help,
#labSLOptBlock details.param-help-inline[open] .param-help,
#labTPFibWrap details.param-help-inline[open] .param-help,
#labSLFibWrap details.param-help-inline[open] .param-help,
#labEAConfig details.param-help-inline[open] .param-help,
#labBayesConfig details.param-help-inline[open] .param-help,
#labModal details.param-help-inline[open] .param-help { display: block; }
#labTPOptBlock details.param-help-inline.heading summary,
#labSLOptBlock details.param-help-inline.heading summary { font-weight: 600; }

/* Section title chip */
#labCoreRanges .section-title {
  width: 100%;
  font-weight: 600;
  padding: 2px 8px;
  border-left: 3px solid #2563eb;
  margin: 2px 0 6px;
}
/* Sticky action bar inside Lab */
#labModal .lab-actions { position: sticky; bottom: 0; left: 0; right: 0; display:flex; gap:8px; justify-content:flex-end; padding: 8px 0 0; background: linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 40%); border-top: 1px solid var(--header-border); z-index: 5; }
#labModal .lab-fixed-actions { position: sticky; bottom: 0; left: 0; right: 0; display:flex; gap:8px; justify-content:flex-end; padding: 10px 0 0; background: linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 50%); border-top: 1px solid var(--header-border); z-index: 8; backdrop-filter: saturate(1.05) blur(2px); }
/* Make heading summaries look like chips */
#labModal details.param-help-inline.heading summary {
  background: var(--bg2, rgba(0,0,0,0.04));
  border: 1px solid var(--header-border);
  border-radius: 8px;
  padding: 4px 8px;
  display: inline-flex;
  align-items: center;
}
/* When headings are inside the form grid, make them start on a new row */
#labModal .form-grid details.param-help-inline.heading { display:block; width:100%; grid-column: 1 / -1; }
#labModal details.param-help-inline.heading summary:hover { background: rgba(37,99,235,0.08); }
#labModal details.param-help-inline.heading summary::before { content: '▸'; margin-right: 6px; opacity: 0.9; transition: transform 160ms ease; }
#labModal details.param-help-inline.heading[open] summary::before { transform: rotate(90deg); }

/* Unify number inputs and selects within Lab */
#labModal input[type=number] { text-align: right; }
#labCoreRanges input[type=number],
#labTPOptBlock input[type=number],
#labSLOptBlock input[type=number] { width: 6rem !important; }
#labModal input[type=number], #labModal select {
  border: 1px solid var(--header-border);
  border-radius: 8px;
  padding: 6px 8px;
  min-height: 32px;
  background: var(--bg);
  color: var(--fg);
}
#labModal option { background: var(--bg); color: var(--fg); }
#labModal input[type=number]:focus, #labModal select:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(37,99,235,0.22);
  border-color: #2563eb;
}

/* Chips for toggles/lists */
#labAdvPanel label,
#labTPOptBlock label,
#labSLOptBlock label { 
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 8px; border: 1px solid var(--header-border); border-radius: 8px; background: var(--bg);
}
#labTPFibWrap label, #labSLFibWrap label {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 10px; border: 1px solid var(--header-border); border-radius: 999px; background: var(--bg);
}
/* Make main Lab blocks look like sections and span full width in grid */
#labModal #labContextCard,
#labModal #labEAConfig,
#labModal #labBayesConfig,
#labModal #labAdvPanel,
#labModal #labCoreRanges,
#labModal #labTPOptBlock,
#labModal #labTPFibWrap,
#labModal #labSLOptBlock,
#labModal #labSLFibWrap { background: var(--bg); border: 1px solid var(--header-border); border-radius: 12px; padding: 10px 12px; box-shadow: 0 1px 0 var(--header-border) inset, 0 8px 20px rgba(0,0,0,0.06); }
#labModal #labAdvPanel { border-style: dashed; }
#labTPFibWrap label:hover, #labSLFibWrap label:hover, #labAdvPanel label:hover { background: var(--bg2, rgba(0,0,0,0.04)); }
#labAdvPanel label:has(> input[type=checkbox]:checked),
#labTPFibWrap label:has(> input[type=checkbox]:checked),
#labSLFibWrap label:has(> input[type=checkbox]:checked) { border-color: #2563eb; background: rgba(37,99,235,0.10); box-shadow: 0 0 0 2px rgba(37,99,235,0.12); }
#labTPFibWrap details.param-help-inline.heading summary,
#labSLFibWrap details.param-help-inline.heading summary,
#labEAConfig details.param-help-inline.heading summary,
#labBayesConfig details.param-help-inline.heading summary,
#labModal details.param-help-inline.heading summary { font-weight: 600; }
@keyframes planeFold {
  0% { clip-path: polygon(0 0,100% 0,100% 100%,0 100%); transform: perspective(1000px) rotateX(0) rotateY(0); }
  40% { clip-path: polygon(6% 4%,94% 6%,94% 94%,6% 96%); transform: perspective(1000px) rotateX(10deg) rotateY(-8deg); }
  70% { clip-path: polygon(0 8%,92% 50%,0 92%,0 92%); transform: perspective(1000px) rotateX(18deg) rotateY(-16deg); }
  100% { clip-path: polygon(0 12%,100% 50%,0 88%); transform: perspective(1000px) rotateX(28deg) rotateY(-22deg); }
}
@keyframes planeFlight {
  0% { transform: perspective(1000px) rotateX(28deg) rotateY(-22deg) rotateZ(0deg) translate3d(0,0,0); filter: drop-shadow(0 14px 28px rgba(0,0,0,0.28)); }
  40% { transform: perspective(1000px) rotateX(24deg) rotateY(-18deg) rotateZ(-10deg) translate3d(-4px,-6px,0); filter: drop-shadow(0 18px 36px rgba(0,0,0,0.32)); }
  80% { transform: perspective(1000px) rotateX(20deg) rotateY(-12deg) rotateZ(-18deg) translate3d(-8px,-10px,0); filter: drop-shadow(0 12px 24px rgba(0,0,0,0.22)); }
  100% { transform: perspective(1000px) rotateX(16deg) rotateY(-8deg) rotateZ(-22deg) translate3d(-12px,-14px,0); filter: drop-shadow(0 6px 16px rgba(0,0,0,0.18)); }
}
#preloadCreases { position:absolute; inset:0; opacity:0; pointer-events:none; background:
  /* Fine dense grid */
  repeating-linear-gradient(0deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 24px),
  repeating-linear-gradient(90deg, rgba(0,0,0,0.10) 0, rgba(0,0,0,0.10) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 24px),
  /* Diagonal accents */
  repeating-linear-gradient(45deg, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.05) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 34px),
  repeating-linear-gradient(135deg, rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px, rgba(0,0,0,0) 1px, rgba(0,0,0,0) 34px);
background-blend-mode: soft-light; will-change: transform, opacity, background-position; }
/* vignette mask to emphasize center */
#preloadCreases { -webkit-mask-image: radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,1) 60%, rgba(0,0,0,0) 100%); mask-image: radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,1) 60%, rgba(0,0,0,0) 100%); }
#preloadCreases.pro-crease-on { opacity: 0.65; transition: opacity 160ms ease; }
#preloadCreases.pro-crease-anim { animation: creaseWave 900ms ease-in-out both; }
@keyframes creaseWave {
  0% { background-position: 0 0, 0 0, 0 0, 0 0; }
  50% { background-position: 8px 6px, -6px -8px, 5px 7px, -7px -5px; }
  100% { background-position: 0 0, 0 0, 0 0, 0 0; }
}

/* Paper-like animations */
.pre-crumple { animation: preCrumple 250ms ease-in-out both; }
.pre-fold { animation: preFold 900ms cubic-bezier(0.22,1,0.36,1) both; }
/* Paper curl (corner roll) */
.paper-curl { animation: paperCurl 600ms cubic-bezier(0.22,1,0.36,1) both; }
@keyframes paperCurl {
  0% { transform: perspective(900px) rotateX(0deg) rotateY(0deg) scale(1); border-radius: 0px; }
  25% { transform: perspective(900px) rotateX(6deg) rotateY(-8deg) scale(0.992); border-radius: 8px; }
  50% { transform: perspective(900px) rotateX(10deg) rotateY(-14deg) scale(0.986); border-radius: 16px; }
  75% { transform: perspective(900px) rotateX(8deg) rotateY(-10deg) scale(0.988); border-radius: 20px; }
  100% { transform: perspective(900px) rotateX(4deg) rotateY(-6deg) scale(0.992); border-radius: 24px; }
}
@keyframes preCrumple {
  0% { transform: none; filter: none; }
  30% { transform: scale(0.985) rotateZ(-0.6deg) skewX(-1.2deg) skewY(0.8deg); filter: contrast(1.03) brightness(0.98); }
  60% { transform: scale(1.015) rotateZ(0.5deg) skewX(1deg) skewY(-1deg); filter: contrast(1.06) brightness(1.02); }
  100% { transform: scale(0.995) rotateZ(-0.2deg); filter: none; }
}
@keyframes preFold {
  0% { transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(1); }
  40% { transform: perspective(800px) rotateX(22deg) rotateY(-16deg) scale(0.96); }
  70% { transform: perspective(800px) rotateX(38deg) rotateY(24deg) scale(0.9); }
  100% { transform: perspective(800px) rotateX(65deg) rotateY(-35deg) scale(0.86); }
}
/* Pro fold (multi-crease feel) */
.pre-fold-pro { animation: preFoldPro 1100ms cubic-bezier(0.22,1,0.36,1) both; }
@keyframes preFoldPro {
  0% { transform: perspective(900px) rotateX(0deg) rotateY(0deg) scale(1); }
  20% { transform: perspective(900px) rotateX(10deg) rotateY(-8deg) scale(0.98); }
  40% { transform: perspective(900px) rotateX(-14deg) rotateY(12deg) scale(0.96); }
  60% { transform: perspective(900px) rotateX(26deg) rotateY(-18deg) scale(0.93); }
  80% { transform: perspective(900px) rotateX(-34deg) rotateY(22deg) scale(0.90); }
  100% { transform: perspective(900px) rotateX(58deg) rotateY(-33deg) scale(0.86); }
}
/* subtle jitter */
.jitter { animation: jitter 220ms ease-in-out 1; }
@keyframes jitter {
  0%,100% { transform: none; }
  30% { transform: translateZ(0) rotateZ(-0.5deg) scale(0.997); }
  60% { transform: translateZ(0) rotateZ(0.6deg) scale(1.004); }
}
@keyframes gridShimmer {
  0% { background-position: 0 0, 0 0; filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
  50% { background-position: 8px 6px, -6px -8px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
  100% { background-position: 0 0, 0 0; filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
}
